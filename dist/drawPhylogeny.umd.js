!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).lwPhyloPlot=e(t.d3)}(this,function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var n=e(t);function a(t,e,n,a){return{x:t+n*Math.cos(a),y:e-n*Math.sin(a)}}function r(t,e,n,r,i){const s=2*Math.PI,l=t=>(t%s+s)%s;let o=l(r),c=l(i);if((o-c+s)%s<(c-o+s)%s){const t=o;o=c,c=t}const h=(c-o+s)%s;if(h<1e-9){const r=a(t,e,n,o);return`M ${r.x} ${r.y}`}const d=h>Math.PI?1:0,p=a(t,e,n,o),f=a(t,e,n,c);return`M ${p.x} ${p.y} A ${n} ${n} 0 ${d} 0 ${f.x} ${f.y}`}const i=2*Math.PI,s=t=>(t%i+i)%i;function l(t,e,n,a,r,i){const l=s(0===i?r-a:a-r);if(!(n>0)||l<1e-9)return"";const o=l>Math.PI?1:0;return`M ${t+n*Math.cos(a)} ${e-n*Math.sin(a)} A ${n} ${n} 0 ${o} ${i} ${t+n*Math.cos(r)} ${e-n*Math.sin(r)}`}function o(t,e=[]){e.push(t);for(let n=0;n<(t.children?.length||0);n++)e=o(t.children[n],e);return e}function c(t,e=!0){var n=[];for(const e of o(t))null===e.parent?n.push({parentId:null,parentLabel:null,thisId:e.id,thisLabel:e.label,children:e.children.map(t=>t.id),branchLength:0,isTip:!1,x:e.x,y:e.y,angle:e.angle}):n.push({parentId:e.parent.id,parentLabel:e.parent.label,thisId:e.id,thisLabel:e.label,children:e.children.map(t=>t.id),branchLength:e.branchLength,isTip:0==e.children.length,x:e.x,y:e.y,angle:e.angle});return e&&(n=n.sort(function(t,e){return t.thisId-e.thisId})),n}function h(t){const e=2*Math.PI,n=c(t,!0),a=new Map(n.map(t=>[t.thisId,t])),r=new Map(n.map(t=>[t.thisId,t.children||[]]));let i=null;for(const t of n)if(null==t.parentId){i=t.thisId;break}const s=[];!function t(e){const n=r.get(e)||[];if(0!==n.length)for(const e of n)t(e);else s.push(e)}(i);const l=Math.max(1,s.length),o=new Map;s.forEach((t,n)=>{o.set(t,n/l*e)}),function t(n){const a=r.get(n)||[];for(const e of a)t(e);if(a.length>0){let t=0,r=0;for(const e of a){const n=o.get(e);t+=Math.cos(n),r+=Math.sin(n)}o.set(n,(Math.atan2(r,t)%e+e)%e)}}(i);const h=new Map;h.set(i,0),function t(e){const n=r.get(e)||[],i=h.get(e)||0;for(const e of n){const n=a.get(e),r=n?.branchLength??0;h.set(e,i+r),t(e)}}(i);for(const t of n){const e=o.get(t.thisId)??0,n=h.get(t.thisId)??0;t.angle=e,t.r=n,t.x=n*Math.cos(e),t.y=n*Math.sin(e)}return n}const d=2*Math.PI,p=t=>(t%d+d)%d;function f(t,e={}){const{openAngleDeg:n=0,rotateDeg:a=0}=e,r=n/360*d,i=a/360*d;let s=null;const l=new Map(t.map(t=>[t.thisId,t.children||[]]));for(const e of t)if(null==e.parentId){s=e.thisId;break}const o=[];!function t(e){const n=l.get(e)||[];if(n.length)for(const e of n)t(e);else o.push(e)}(s);const c=Math.max(1,o.length),h=c>1?(d*(1-1/c)-r)/(c-1):0,f=new Map;return o.forEach((t,e)=>f.set(t,p(e*h+i))),function t(e){const n=l.get(e)||[];for(const e of n)t(e);if(n.length){const t=f.get(n[0]),a=n.map(e=>function(t,e){let n=e;for(;n<t-Math.PI;)n+=d;for(;n>t+Math.PI;)n-=d;return n}(t,f.get(e)));f.set(e,p(a.reduce((t,e)=>t+e,0)/a.length))}}(s),f}function u(t,e={}){const{angleStrategy:n="fan",arcsStyle:a="fan",openAngleDeg:r=0,rotateDeg:i=0}=e,s=h(t);if("fan"===n){const t=f(s,{openAngleDeg:r,rotateDeg:i});for(const e of s){const n=t.get(e.thisId);null!=n&&(e.angle=n,e.x=e.r*Math.cos(n),e.y=e.r*Math.sin(n))}}const l="fan"===n?function(t){const e=new Map(t.map(t=>[t.thisId,t])),n=t.find(t=>null==t.parentId)?.thisId,a=[];for(const r of t){if(r.thisId===n)continue;const t=e.get(r.parentId);if(!t)continue;const i=r.angle,s=t.r,l=r.r;a.push({parentId:t.thisId,childId:r.thisId,x0:s*Math.cos(i),y0:s*Math.sin(i),x1:l*Math.cos(i),y1:l*Math.sin(i),isTip:!!r.isTip})}return a}(s):function(t){const e=h(t),n=new Map(e.map(t=>[t.thisId,t])),a=e.find(t=>null==t.parentId)?.thisId,r=[];for(const t of e){if(t.thisId===a)continue;const e=n.get(t.parentId);if(!e)continue;const i=t.angle,s=e.r,l=t.r;r.push({parentId:e.thisId,childId:t.thisId,x0:s*Math.cos(i),y0:s*Math.sin(i),x1:l*Math.cos(i),y1:l*Math.sin(i),isTip:!!t.isTip})}return r}(t),o="fan"===a?function(t){const e=new Map(t.map(t=>[t.thisId,t])),n=[];for(const a of t){const t=a.children||[];if(t.length<2||!(a.r>0))continue;const r=e.get(t[0])?.angle,i=e.get(t[t.length-1])?.angle;if(null==r||null==i)continue;const s=r,l=i,o=l>=s?0:1;n.push({parentId:a.parentId,thisId:a.thisId,radius:a.r,start:s,end:l,sweep:o})}return n}(s):function(t){const e=2*Math.PI;new Map(t.map(t=>[t.thisId,t]));const n=new Map;let a=null;for(const e of t)null==e.parentId&&(a=e.thisId),n.has(e.parentId)||n.set(e.parentId,[]),n.get(e.parentId).push(e);const r=[];for(const i of t){const t=i.thisId;if(t===a)continue;const s=n.get(t)||[];if(s.length<2)continue;const l=s.map(t=>(t.angle%e+e)%e).sort((t,e)=>t-e),o=l[0],c=l[l.length-1],h=c-o,d=e-h;let p,f,u;h<=d?(p=o,f=c,u=h):(p=c,f=o,u=d),u<1e-6||!isFinite(i.r)||i.r<=0||r.push({start:p,end:f,radius:i.r,thisId:t,parentId:i.parentId})}return r}(s),c=function(t){const e=new Map(t.map(t=>[t.thisId,t])),n=[];for(const a of t){if(null==a.parentId)continue;const t=e.get(a.parentId);t&&n.push({parentId:t.thisId,childId:a.thisId,radius:t.r,start:t.angle,end:a.angle})}return n}(s);return{data:s,radii:l,arcs:o,child_arcs:c}}function g(t){const e=c(t),n=new Map(e.map((t,e)=>[t.thisId,e])),a=[];!function t(e){e.children&&0!==e.children.length?e.children.forEach(t):a.push(e.id)}(t);const r=new Map(a.map((t,e)=>[t,e+1]));return function t(a){const i=n.get(a.id);if(!a.children||0===a.children.length){const t=r.get(a.id);return e[i].y0=t,e[i].y1=t,t}const s=function(t){let e=0,n=0;for(let a of t)null!=a&&(a=+a)>=a&&(++e,n+=a);if(e)return n/e}(a.children.map(t));return e[i].y0=s,e[i].y1=s,s}(t),function t(a,r){const i=n.get(a.id),s=r??0,l=s+(e[i].branchLength??0);e[i].x0=s,e[i].x1=l,a.children&&a.children.length&&a.children.forEach(e=>t(e,l))}(t,0),e.map(t=>{const{y:e,x:n,angle:a,...r}=t;return r})}function I(t){const e=g(t),n=function(t){const e=g(t),n=new Map;for(const t of e){if(null==t.parentId)continue;const e=n.get(t.parentId);e?e.push(t):n.set(t.parentId,[t])}const a=[];for(const[t,e]of n.entries()){if(!e.length)continue;const n=e.map(t=>t.y0),r=Math.min(...n),i=Math.max(...n),s=e[0].x0;a.push({parentId:t,x0:s,x1:s,y0:r,y1:i,heights:i-r})}return a}(t),a=function(t){const e=g(t),n=new Map(e.map(t=>[t.thisId,t])),a=[];for(const t of e){if(null==t.parentId)continue;const e=n.get(t.parentId);if(!e)continue;const r=t.x0,i=t.y0,s=e.y0,l=Math.min(i,s),o=Math.max(i,s);a.push({parentId:t.parentId,childId:t.thisId,x:r,y0:l,y1:o})}return a}(t);new Map(e.map(t=>[t.thisId,t]));const r=e.filter(t=>null!=t.parentId).map(t=>({parentId:t.parentId,childId:t.thisId,thisId:t.thisId,thisLabel:t.thisLabel,isTip:t.isTip,x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y0}));return{data:e,vertical_lines:n,child_vertical_lines:a,horizontal_lines:r}}function x(t){null===t.parent&&(function t(e){if(!e.children||0===e.children.length)return e.ntips=1,1;let n=0;for(const a of e.children)n+=t(a);return e.ntips=n,n}(t),t.start=0,t.end=2,t.angle=0,t.ntips=function(t){var e=0;for(const n of function(t){const e=[t],n=[];for(;e.length;){const t=e.shift();n.push(t);for(const n of t.children)e.push(n)}return n}(t))0==n.children.length&&e++;return e}(t),t.x=0,t.y=0);let e=t.start;for(let n=0;n<t.children.length;n++){const a=t.children[n],r=(t.end-t.start)*(a.ntips/t.ntips);a.start=e,a.end=e+r,a.angle=a.start+(a.end-a.start)/2,e=a.end;const i=a.angle*Math.PI,s=a.branchLength??0;a.x=t.x+s*Math.sin(i),a.y=t.y+s*Math.cos(i),x(a)}return t}function y(t){var e={},n=c(x(t));return e.data=n,e.edges=function(t,e=!1){const n=[...t].sort((t,e)=>t.thisId-e.thisId),a=new Map(n.map(t=>[t.thisId,t])),r=[];for(const t of n){if(null==t.parentId)continue;const n=a.get(t.parentId);n&&(e?(r.push({x1:t.x,y1:t.y,id1:t.thisId,x2:n.x,y2:t.y,id2:void 0}),r.push({x1:n.x,y1:t.y,id1:void 0,x2:n.x,y2:n.y,id2:t.parentId})):r.push({x1:t.x,y1:t.y,id1:t.thisId,x2:n.x,y2:n.y,id2:t.parentId}))}return r}(n),e}function m(t){const e=(t=String(t).replace(/\s+/g,"")).split(/(;|\(|\)|,)/),n={parent:null,children:[]};let a=n,r=0;for(const t of e)if(t&&";"!==t)if("("===t){const t={parent:a,children:[]};a.children.push(t),a=t}else if(","===t){a=a.parent;const t={parent:a,children:[]};a.children.push(t),a=t}else if(")"===t){if(a=a.parent,null===a)break}else{const e=t.split(":");1===e.length?t.startsWith(":")?(a.label="",a.branchLength=parseFloat(e[0])):(a.label=e[0],a.branchLength=null):2===e.length?(a.label=e[0],a.branchLength=parseFloat(e[1])):(console.warn(t,"Unhandled token with multiple ':' characters"),a.label=e[0]||"",a.branchLength=parseFloat(e[e.length-1])),a.id=r++}return null==n.id&&(n.id=r),n}return function(t,{layout:e="rect",width:a=800,height:i=800,margin:s={top:20,right:300,bottom:20,left:50},radialMargin:o=80,strokeWidth:c=1,radialMode:h="outer",tipLabels:d=!0,showTooltips:p=!0,tooltipFormatter:f=(t,e)=>`${t.thisLabel??"(unnamed)"}\nrootâ†’tip: ${(+e).toFixed(4)}`,hoverStroke:g="#1f77b4",hoverWidth:x=3,highlightTips:M=[],highlightStroke:b="#e63946",highlightWidth:w=2.5}={}){const k=t=>"number"==typeof t&&Number.isFinite(t);function v(t,{prefer:e="auto"}={}){return function(n){let a=t.get(n);if(!a)return 0;if("r"===e||"auto"===e&&"r"in a)return Number(a.r??0);if("x1"===e||"auto"===e&&"x1"in a)return Number(a.x1??0);let r=0;for(;a&&null!=a.parentId;)r+=Number(a.branchLength||0),a=t.get(a.parentId);return r}}if("rect"===e){const _=I(m(t)),L=_.horizontal_lines,A=_.vertical_lines,$=L.filter(t=>t.isTip),T=new Map(L.map(t=>[t.thisId,t])),P=new Map($.map(t=>[t.thisId,t])),j=new Map($.map(t=>[t.thisLabel,t])),E=v(T,{prefer:"x1"}),S=n.max(L,t=>t.y1),z=n.min(L,t=>t.y1),D=n.max(L,t=>t.x1),F=n.scaleLinear().domain([z-1,S+1]).range([s.top,i-s.bottom]),O=n.scaleLinear().domain([0,D]).range([s.left,a-s.right]),X=n.create("svg").attr("width",a).attr("height",i).attr("font-family","sans-serif").attr("font-size",10),Y=X.append("g"),N=X.append("g").attr("class","phylo_static_highlight"),W=X.append("g").attr("class","phylo_hover_highlight");Y.selectAll(".hline").data(L).join("line").attr("x1",t=>O(t.x0)).attr("y1",t=>F(t.y0)).attr("x2",t=>O(t.x1)).attr("y2",t=>F(t.y1)).attr("stroke","#555").attr("stroke-width",c),Y.selectAll(".vline").data(A).join("line").attr("x1",t=>O(t.x0)).attr("y1",t=>F(t.y0)).attr("x2",t=>O(t.x1)).attr("y2",t=>F(t.y1)).attr("stroke","#555").attr("stroke-width",c);const B=Y.selectAll(".tip-dot").data($).join("circle").attr("cx",t=>O(t.x1)).attr("cy",t=>F(t.y1)).attr("r",2).attr("fill","black");if(p&&B.append("title").text(t=>f(t,E(t.thisId))),B.on("mouseenter",function(t,e){U(e.thisId,W,g,x),n.select(this).attr("r",4)}).on("mouseleave",function(){W.selectAll("*").remove(),n.select(this).attr("r",2)}),d){const q=X.append("g").attr("class","phylo_labels").selectAll("text").data($).join("text").attr("x",t=>O(t.x1)+4).attr("y",t=>F(t.y1)).attr("dy","0.32em").attr("font-size",10).text(t=>t.thisLabel?.replace(/_/g," ")??"");p&&q.append("title").text(t=>f(t,E(t.thisId))),q.on("mouseenter",function(t,e){U(e.thisId,W,g,x),n.select(this).attr("font-weight",600)}).on("mouseleave",function(){W.selectAll("*").remove(),n.select(this).attr("font-weight",null)})}if(M&&M.length){new Set([...M.filter(k).map(t=>P.get(t)),...M.filter(t=>!k(t)).map(t=>j.get(t))].filter(Boolean)).forEach(t=>{U(t.thisId,N,b,w)})}function U(t,e,n,a){e.selectAll("*").remove();let r=T.get(t);for(;r&&null!=r.parentId;){const t=T.get(r.parentId);if(!t)break;e.append("line").attr("x1",O(r.x0)).attr("x2",O(r.x0)).attr("y1",F(t.y0)).attr("y2",F(r.y0)).attr("stroke",n).attr("stroke-width",a).attr("stroke-linecap","round"),e.append("line").attr("x1",O(r.x0)).attr("x2",O(r.x1)).attr("y1",F(r.y0)).attr("y2",F(r.y1)).attr("stroke",n).attr("stroke-width",a).attr("stroke-linecap","round"),r=t}}return X.node()}if("radial"===e){const C=u(m(t),{angleStrategy:"fan",arcsStyle:"fan"}),G="outer"===h,H=3,J=0,K=(n.max(C.data,t=>t.r)??0)+2*o,Q=a,R=i,V=Q/2,Z=R/2,tt=n.scaleLinear().domain([-K,K]).range([0,Q]),et=n.scaleLinear().domain([-K,K]).range([R,0]),nt=t=>t*(Q/(2*K)),at=new Map(C.data.map(t=>[t.thisId,t])),rt=C.data.filter(t=>t.isTip),it=rt.length?n.max(rt,t=>t.r):0,st=v(at,{prefer:"r"}),lt=new Map(rt.map(t=>[t.thisId,t])),ot=new Map(rt.map(t=>[t.thisLabel,t]));function ct(t){return t.childId??t.thisId??t.id1??null}function ht(t,e,n,a){const r=tt(t),i=et(e),s=tt(n)-r,l=et(a)-i,o=Math.hypot(s,l)||1,c=Math.max(0,(o-J)/o);return{X0:r,Y0:i,X1s:r+s*c,Y1s:i+l*c,len:o}}const dt=n.create("svg").attr("width",Q).attr("height",R).attr("font-family","sans-serif").attr("font-size",10),pt=dt.append("g"),ft=dt.append("g").attr("class","phylo_static_lines"),ut=dt.append("g").attr("class","phylo_static_arcs"),gt=dt.append("g").attr("class","phylo_hover_lines"),It=dt.append("g").attr("class","phylo_hover_arcs");pt.append("g").attr("class","phylo_arcs").selectAll("path").data(C.arcs).join("path").attr("d",t=>r(V,Z,Math.max(0,nt(t.radius)),t.start,t.end)).attr("fill","none").attr("stroke","#777").attr("stroke-width",c),pt.append("g").attr("class","phylo_radii").selectAll("line").data(C.radii).join("line").each(function(t,e){const a=t.x0,r=t.y0,i=ct(t),s=null!=i?at.get(i):void 0,l=!(!s||!s.isTip);let o=t.x1,h=t.y1;G&&l&&(o=it*Math.cos(s.angle),h=it*Math.sin(s.angle));const{X0:d,Y0:p,X1s:f,Y1s:u}=ht(a,r,o,h);n.select(this).attr("x1",d).attr("y1",p).attr("x2",f).attr("y2",u).attr("stroke","#777").attr("stroke-width",c)});const xt=pt.append("g").attr("class","phylo_tip_dots").selectAll("circle").data(rt).join("circle").each(function(t,e){const a=G?it*Math.cos(t.angle):t.x,r=G?it*Math.sin(t.angle):t.y;n.select(this).attr("cx",tt(a)).attr("cy",et(r)).attr("r",H).attr("fill","black").attr("stroke","black").attr("stroke-width",1.5)});p&&xt.append("title").text(t=>f(t,st(t.thisId)));const yt=new Map(C.radii.map(t=>[ct(t),t])),mt=new Map(C.child_arcs.map(t=>[t.childId,t]));if(d){const bt=pt.append("g").attr("class","phylo_labels").selectAll("g.label").data(rt).join("g").attr("class","label").attr("transform",t=>{const e=G?it:t.r,n=e*Math.cos(t.angle),a=e*Math.sin(t.angle);return`translate(${tt(n)},${et(a)})`}).each(function(t){let e=180*-t.angle/Math.PI,a=10,r="start";t.angle>Math.PI/2&&t.angle<3*Math.PI/2&&(e+=180,a*=-1,r="end"),n.select(this).append("g").attr("transform",`rotate(${e})`).append("text").attr("x",a).attr("alignment-baseline","middle").attr("text-anchor",r).attr("font-size",10).attr("fill","black").text(t=>t.thisLabel?.replace(/_/g," ")??"")});p&&bt.append("title").text(t=>f(t,st(t.thisId))),bt.on("mouseenter",function(t,e){Mt(e,gt,It,g,x),n.select(this).select("text").attr("font-weight",600)}).on("mouseleave",function(){gt.selectAll("*").remove(),It.selectAll("*").remove(),n.select(this).select("text").attr("font-weight",null)})}function Mt(t,e,n,a="#1f77b4",i=3){e.selectAll("*").remove(),n.selectAll("*").remove();let s="number"==typeof t?at.get(t):t;if(!s)return;let o=!0;for(;s&&null!=s.parentId;){const t=yt.get(s.thisId);if(t){const n=t.x0,r=t.y0;let l=t.x1,c=t.y1;if(G&&o&&s.isTip){const t=it;l=t*Math.cos(s.angle),c=t*Math.sin(s.angle)}const{X0:h,Y0:d,X1s:p,Y1s:f}=ht(n,r,l,c);e.append("line").attr("x1",h).attr("y1",d).attr("x2",p).attr("y2",f).attr("stroke",a).attr("stroke-width",i).attr("stroke-linecap","round")}mt.get(s.thisId)&&n.append("path").attr("d",t=>null==t.sweep?r(V,Z,nt(t.radius),t.start,t.end):l(V,Z,nt(t.radius),t.start,t.end,t.sweep)).attr("fill","none").attr("stroke",a).attr("stroke-width",i),o=!1,s=at.get(s.parentId)}}if(xt.on("mouseenter",function(t,e){Mt(e,gt,It,g,x),n.select(this).attr("r",H+2)}).on("mouseleave",function(){gt.selectAll("*").remove(),It.selectAll("*").remove(),n.select(this).attr("r",H)}),M&&M.length){new Set([...M.filter(k).map(t=>lt.get(t)),...M.filter(t=>!k(t)).map(t=>ot.get(t))].filter(Boolean)).forEach(t=>{Mt(t.thisId,ft,ut,b,w)})}return dt.node()}if("unrooted"===e){const wt=y(m(t)),kt=a,vt=i,_t=n.extent(wt.data,t=>t.x),Lt=n.extent(wt.data,t=>t.y),At=Math.max(Math.abs(_t[0]),Math.abs(_t[1])),$t=Math.max(Math.abs(Lt[0]),Math.abs(Lt[1])),Tt=Math.max(At,$t)+2*o,Pt=n.scaleLinear().domain([-Tt,Tt]).range([0,kt]),jt=n.scaleLinear().domain([-Tt,Tt]).range([vt,0]),Et=n.create("svg").attr("width",kt).attr("height",vt).attr("font-family","sans-serif").attr("font-size",10),St=Et.append("g"),zt=Et.append("g").attr("class","phylo_static_highlight"),Dt=Et.append("g").attr("class","phylo_hover_highlight");St.append("g").attr("class","phylo_lines").selectAll("line").data(wt.edges).join("line").attr("x1",t=>Pt(t.x1)).attr("y1",t=>jt(t.y1)).attr("x2",t=>Pt(t.x2)).attr("y2",t=>jt(t.y2)).attr("stroke-width",c).attr("stroke","#777");const Ft=St.append("g").attr("class","phylo_points").selectAll("circle").data(wt.data).join("circle").attr("class","dot").attr("r",t=>t.isTip?4:0).attr("cx",t=>Pt(t.x)).attr("cy",t=>jt(t.y)).attr("stroke","black").attr("stroke-width",2).attr("fill",t=>t.isTip?"black":"white"),Ot=new Map(wt.data.map(t=>[t.thisId,t])),Xt=new Map(wt.data.filter(t=>t.isTip).map(t=>[t.thisId,t])),Yt=new Map(wt.data.filter(t=>t.isTip).map(t=>[t.thisLabel,t])),Nt=v(Ot);p&&Ft.filter(t=>t.isTip).append("title").text(t=>f(t,Nt(t.thisId)));const Wt=new Map,Bt=new Map(wt.data.map(t=>[t.thisId,t]));if(wt.edges.forEach(t=>{const e=Bt.get(t.id1);e?.isTip&&Wt.set(t.id1,t)}),d){const qt=St.append("g").attr("class","phylo_labels").selectAll("g").data(wt.data.filter(t=>t.isTip)).join("g").attr("transform",t=>`translate(${Pt(t.x)},${jt(t.y)})`).each(function(t){const e=Wt.get(t.thisId);if(!e)return;const a=Pt(e.x1),r=jt(e.y1),i=Pt(e.x2)-a,s=jt(e.y2)-r;let l=180*Math.atan2(s,i)/Math.PI,o=-10,c="end";(l>90||l<-90)&&(l+=180,c="start",o=10),n.select(this).append("g").attr("transform",`rotate(${l})`).append("text").attr("x",o).attr("alignment-baseline","middle").attr("text-anchor",c).attr("font-size",10).attr("fill","black").text(t.thisLabel?.replace(/_/g," ")??"")});p&&qt.append("title").text(t=>f(t,Nt(t.thisId))),qt.on("mouseenter",function(t,e){Ut(e.thisId,Dt,g,x),n.select(this).select("text").attr("font-weight",600)}).on("mouseleave",function(){Dt.selectAll("*").remove(),n.select(this).select("text").attr("font-weight",null)})}if(Ft.filter(t=>t.isTip).on("mouseenter",function(t,e){Ut(e.thisId,Dt,g,x),n.select(this).attr("r",6)}).on("mouseleave",function(){Dt.selectAll("*").remove(),n.select(this).attr("r",4)}),M&&M.length){new Set([...M.filter(k).map(t=>Xt.get(t)),...M.filter(t=>!k(t)).map(t=>Yt.get(t))].filter(Boolean)).forEach(t=>{Ut(t.thisId,zt,b,w)})}function Ut(t,e,n,a){const r=new Map(wt.edges.map(t=>[t.id1,t]));e.selectAll("*").remove();let i=Ot.get(t);for(;i&&null!=i.parentId;){const t=r.get(i.thisId);t&&e.append("line").attr("x1",Pt(t.x1)).attr("y1",jt(t.y1)).attr("x2",Pt(t.x2)).attr("y2",jt(t.y2)).attr("stroke",n).attr("stroke-width",a).attr("stroke-linecap","round"),i=Ot.get(i.parentId)}}return Et.node()}throw new Error("Unsupported layout type. Use 'rect', 'radial', or 'unrooted'.")}});
//# sourceMappingURL=drawPhylogeny.umd.js.map

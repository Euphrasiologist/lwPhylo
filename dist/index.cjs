"use strict";const t={circular:()=>{let t=200,n=2,e=[0,0],r={},i=0,s=0,a=t*t,c=10;function o(){const e=Math.exp(n);return i=e/(e-1)*t,s=n/t,a=t*t,h}function h(t){!function(){if(!r||"function"!=typeof r.xscale||"function"!=typeof r.yscale)throw new Error("phisheye.circular: call .scales(xscale, yscale) before using the fisheye.")}();const n=r.xscale(t.x),o=r.yscale(t.y),h=n-e[0],l=o-e[1],u=h*h+l*l;if(0===u||u>=a)return{x:n,y:o,z:u>=a?1:c};const d=Math.sqrt(u),f=i*(1-Math.exp(-d*s))/d*.75+.25;return{x:e[0]+h*f,y:e[1]+l*f,z:Math.min(f,c)}}return h.radius=function(n){return arguments.length?(t=Math.max(0,+n),o()):t},h.distortion=function(t){return arguments.length?(n=Math.max(0,+t),o()):n},h.focus=function(t){if(!arguments.length)return e.slice();if(!Array.isArray(t)||2!==t.length)throw new Error("focus expects [x, y] in pixels.");return e=[+t[0],+t[1]],h},h.scales=function(t,n){return arguments.length?(r={xscale:t,yscale:n},h):r},h.setScales=h.scales,h.clampZ=function(t){return arguments.length?(c=Math.max(1,+t),h):c},h.focusFromEvent=function(t,n){const e=n.getBoundingClientRect(),r=t.clientX-e.left,i=t.clientY-e.top;return h.focus([r,i])},o()}};function n(t,n,e,r){return{x:t+e*Math.cos(r),y:n+e*Math.sin(r)}}function e(t){const n=t%(2*Math.PI);return n<0?n+2*Math.PI:n}function r(t,n=[]){n.push(t);for(let e=0;e<(t.children?.length||0);e++)n=r(t.children[e],n);return n}function i(t,n=!0){var e=[];for(const n of r(t))null===n.parent?e.push({parentId:null,parentLabel:null,thisId:n.id,thisLabel:n.label,children:n.children.map(t=>t.id),branchLength:0,isTip:!1,x:n.x,y:n.y,angle:n.angle}):e.push({parentId:n.parent.id,parentLabel:n.parent.label,thisId:n.id,thisLabel:n.label,children:n.children.map(t=>t.id),branchLength:n.branchLength,isTip:0==n.children.length,x:n.x,y:n.y,angle:n.angle});return n&&(e=e.sort(function(t,n){return t.thisId-n.thisId})),e}function s(t){const n=2*Math.PI,e=i(t,!0),r=new Map(e.map(t=>[t.thisId,t])),s=new Map(e.map(t=>[t.thisId,t.children||[]]));let a=null;for(const t of e)if(null==t.parentId){a=t.thisId;break}const c=[];!function t(n){const e=s.get(n)||[];if(0!==e.length)for(const n of e)t(n);else c.push(n)}(a);const o=Math.max(1,c.length),h=new Map;c.forEach((t,e)=>{h.set(t,e/o*n)}),function t(e){const r=s.get(e)||[];for(const n of r)t(n);if(r.length>0){let t=0,i=0;for(const n of r){const e=h.get(n);t+=Math.cos(e),i+=Math.sin(e)}h.set(e,(Math.atan2(i,t)%n+n)%n)}}(a);const l=new Map;l.set(a,0),function t(n){const e=s.get(n)||[],i=l.get(n)||0;for(const n of e){const e=r.get(n),s=e?.branchLength??0;l.set(n,i+s),t(n)}}(a);for(const t of e){const n=h.get(t.thisId)??0,e=l.get(t.thisId)??0;t.angle=n,t.r=e,t.x=e*Math.cos(n),t.y=e*Math.sin(n)}return e}function a(t){const n=t%(2*Math.PI);return n<0?n+2*Math.PI:n}function c(t,n){t=a(t);let e=(n=a(n))-t;return e<=-Math.PI?e+=2*Math.PI:e>Math.PI&&(e-=2*Math.PI),[t,t+e]}function o(t){const n=i(t),e=new Map(n.map((t,n)=>[t.thisId,n])),r=[];!function t(n){n.children&&0!==n.children.length?n.children.forEach(t):r.push(n.id)}(t);const s=new Map(r.map((t,n)=>[t,n+1]));return function t(r){const i=e.get(r.id);if(!r.children||0===r.children.length){const t=s.get(r.id);return n[i].y0=t,n[i].y1=t,t}const a=function(t){let n=0,e=0;for(let r of t)null!=r&&(r=+r)>=r&&(++n,e+=r);if(n)return e/n}(r.children.map(t));return n[i].y0=a,n[i].y1=a,a}(t),function t(r,i){const s=e.get(r.id),a=i??0,c=a+(n[s].branchLength??0);n[s].x0=a,n[s].x1=c,r.children&&r.children.length&&r.children.forEach(n=>t(n,c))}(t,0),n.map(t=>{const{y:n,x:e,angle:r,...i}=t;return i})}function h(t){null===t.parent&&(function t(n){if(!n.children||0===n.children.length)return n.ntips=1,1;let e=0;for(const r of n.children)e+=t(r);return n.ntips=e,e}(t),t.start=0,t.end=2,t.angle=0,t.ntips=function(t){var n=0;for(const e of function(t){const n=[t],e=[];for(;n.length;){const t=n.shift();e.push(t);for(const e of t.children)n.push(e)}return e}(t))0==e.children.length&&n++;return n}(t),t.x=0,t.y=0);let n=t.start;for(let e=0;e<t.children.length;e++){const r=t.children[e],i=(t.end-t.start)*(r.ntips/t.ntips);r.start=n,r.end=n+i,r.angle=r.start+(r.end-r.start)/2,n=r.end;const s=r.angle*Math.PI,a=r.branchLength??0;r.x=t.x+a*Math.sin(s),r.y=t.y+a*Math.cos(s),h(r)}return t}exports.describeArc=function(t,r,i,s,a){let c=e(s),o=e(a)-c;o<=-Math.PI?o+=2*Math.PI:o>Math.PI&&(o-=2*Math.PI);const h=Math.abs(o)>Math.PI?1:0,l=o>=0?1:0,u=n(t,r,i,c),d=n(t,r,i,c+o);return["M",u.x,u.y,"A",i,i,0,h,l,d.x,d.y].join(" ")},exports.parentFisheye=function(t,n){const e=function(t,n="thisId"){return new Map(t.map(t=>[t[n],t]))}(n).get(t.parentId);return e?{px:e.fisheye.x,py:e.fisheye.y}:null},exports.phisheye=t,exports.radialLayout=function(t){const n={};return n.data=s(t),n.radii=function(t){const n=s(t),e=new Map(n.map(t=>[t.thisId,t])),r=n.find(t=>null==t.parentId)?.thisId,i=[];for(const t of n){if(t.thisId===r)continue;const n=e.get(t.parentId);if(!n)continue;const s=t.angle,a=n.r,c=t.r;i.push({parentId:n.thisId,childId:t.thisId,x0:a*Math.cos(s),y0:a*Math.sin(s),x1:c*Math.cos(s),y1:c*Math.sin(s),isTip:!!t.isTip})}return i}(t),n.arcs=function(t){const n=new Map(t.map(t=>[t.thisId,t])),e=t.find(t=>null==t.parentId)?.thisId,r=[];for(const i of t){if(i.thisId===e)continue;const t=n.get(i.parentId);if(!t)continue;const[s,a]=c(t.angle,i.angle);isFinite(t.r)&&0!==t.r&&s!==a&&r.push({parentId:t.thisId,childId:i.thisId,radius:t.r,start:s,end:a})}return r}(n.data),n},exports.readTree=function(t){const n=(t=String(t).replace(/\s+/g,"")).split(/(;|\(|\)|,)/),e={parent:null,children:[]};let r=e,i=0;for(const t of n)if(t&&";"!==t)if("("===t){const t={parent:r,children:[]};r.children.push(t),r=t}else if(","===t){r=r.parent;const t={parent:r,children:[]};r.children.push(t),r=t}else if(")"===t){if(r=r.parent,null===r)break}else{const n=t.split(":");1===n.length?t.startsWith(":")?(r.label="",r.branchLength=parseFloat(n[0])):(r.label=n[0],r.branchLength=null):2===n.length?(r.label=n[0],r.branchLength=parseFloat(n[1])):(console.warn(t,"Unhandled token with multiple ':' characters"),r.label=n[0]||"",r.branchLength=parseFloat(n[n.length-1])),r.id=i++}return null==e.id&&(e.id=i),e},exports.rectangleLayout=function(t){const n=o(t),e=function(t){const n=o(t),e=new Map;for(const t of n){if(null==t.parentId)continue;const n=e.get(t.parentId);n?n.push(t):e.set(t.parentId,[t])}const r=[];for(const[t,n]of e.entries()){if(!n.length)continue;const e=n.map(t=>t.y0),i=Math.min(...e),s=Math.max(...e),a=n[0].x0;r.push({parentId:t,x0:a,x1:a,y0:i,y1:s,heights:s-i})}return r}(t),r=function(t){const n=o(t),e=new Map(n.map(t=>[t.thisId,t])),r=[];for(const t of n){if(null==t.parentId)continue;const n=e.get(t.parentId);if(!n)continue;const i=t.x0,s=t.y0,a=n.y0,c=Math.min(s,a),o=Math.max(s,a);r.push({parentId:t.parentId,childId:t.thisId,x:i,y0:c,y1:o})}return r}(t),i=n.filter(t=>null!=t.parentId).map(t=>({parentId:t.parentId,childId:t.thisId,x0:t.x0,x1:t.x1,y:t.y0}));return{data:n,vertical_lines:e,child_vertical_lines:r,horizontal_lines:i}},exports.subTree=function(t,n){let e={};t.data.forEach(t=>{e[t.thisId]={...t}});let r={};const i=function(t){e[t]&&(r[t]=e[t],e[t].children&&e[t].children.forEach(t=>{i(t)}))};i(n);const s=[["data",Object.values(r)]],a=s[0][1].map(t=>t.thisId);var c=[];for(const n in t)"data"!==n&&c.push([n,t[n]]);var o=c.map(t=>[t[0],t[1].filter(t=>a.includes(t.thisId))]);return Object.fromEntries(s.concat(o))},exports.unrooted=function(t){var n={},e=i(h(t));return n.data=e,n.edges=function(t,n=!1){const e=[...t].sort((t,n)=>t.thisId-n.thisId),r=new Map(e.map(t=>[t.thisId,t])),i=[];for(const t of e){if(null==t.parentId)continue;const e=r.get(t.parentId);e&&(n?(i.push({x1:t.x,y1:t.y,id1:t.thisId,x2:e.x,y2:t.y,id2:void 0}),i.push({x1:e.x,y1:t.y,id1:void 0,x2:e.x,y2:e.y,id2:t.parentId})):i.push({x1:t.x,y1:t.y,id1:t.thisId,x2:e.x,y2:e.y,id2:t.parentId}))}return i}(e),n};
//# sourceMappingURL=index.cjs.map

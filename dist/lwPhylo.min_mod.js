function describeArc(r,a,n,o,t){var i=polarToCartesian(r,a,n,o),e=polarToCartesian(r,a,n,t);return["M",i.x,i.y,"A",n,n,0,0,0,e.x,e.y].join(" ")}function polarToCartesian(r,a,n,o){return{x:r+n*Math.cos(o),y:a+n*Math.sin(o)}}function radialLayout(t){var a={};return a.radii=get_radii(t),a.data=radial_data(t),a.arcs=get_arcs(a.data),a}function get_arcs(t){var a=[],n=t.map(t=>null===t.parentId?t.thisId:null).filter(t=>null!=t)[0];function r(a){for(var n=0;n<t.length;n++)if(t[n].parentId===a)var r=t[n].angle;return r}function e(a){for(var n=0;n<t.length;n++)if(t[n].thisId===a)var r=t[n].r;return r}for(var i=0;i<t.length;i++)t[i].thisId!==n&&a.push({start:reflectAngle(Math.min(t[i].angle,r(t[i].parentId)),"Y"),end:reflectAngle(Math.max(t[i].angle,r(t[i].parentId)),"Y"),radius:e(t[i].parentId),thisId:t[i].thisId,parentId:t[i].parentId});for(i=0;i<a.length;i++)Math.sign(a[i].start)!==Math.sign(a[i].end)&&(a[i].end=Math.abs(a[i].end),a[i].start=-Math.abs(a[i].start));return a.filter(t=>t.start!==t.end&0!==t.radius)}function reflectAngle(t,a){const n=Math.cos(t),r=Math.sin(t);return(e=Math.atan2(..."X"===a?[r,-n]:[-r,n])).toString().includes("3.1415")&&(e=Math.abs(e)),e;var e}function get_radii(t){var a=radial_data(t);function n(t){for(var n=0;n<a.length;n++)if(a[n].thisId===t.parentId)var r=a[n].r;return r}for(var r=[],e=a.map(t=>null===t.parentId?t.thisId:null).filter(t=>null!=t)[0],i=0;i<a.length;i++)a[i].thisId!==e&&r.push({thisId:a[i].thisId,thisLabel:a[i].thisLabel,x0:a[i].x,x1:n(a[i])*Math.cos(a[i].angle),y0:a[i].y,y1:n(a[i])*Math.sin(a[i].angle),isTip:a[i].isTip});return r}function radial_data(t){for(var a=fortify(t),n=numTips(t),r=1,e=0;e<a.length;e++)1==a[e].isTip&&(a[e].angle=r/n*2*Math.PI,r+=1);function i(t,n){for(var r=0;r<a.length;r++){if(a[r].thisId===t)var e=a[r].angle;if(a[r].thisId===n)var i=a[r].angle}return(h=[e,i]).reduce((t,a)=>t+a)/h.length;var h}for(e=0;e<a.length;e++)!1===a[e].isTip&&(a[e].angle=i(a[e].children[0],a[e].children[1]));var h=a.map(t=>null===t.parentId?t.thisId:null).filter(t=>null!=t)[0];function l(t){for(var n=0;n<a.length;n++)if(a[n].thisId===t)var r=a[n].r;return r}a.sort((t,a)=>a.thisId-t.thisId);for(e=0;e<a.length;e++)if(a[e].parentId===h)!0===a[e].isTip?(a[e].r=a[e].branchLength,a[e].x=a[e].branchLength,a[e].y=0):(a[e].r=a[e].branchLength,a[e].x=a[e].branchLength*Math.cos(a[e].angle),a[e].y=a[e].branchLength*Math.sin(a[e].angle));else{var s=l(a[e].parentId);a[e].r=s+a[e].branchLength,a[e].x=(s+a[e].branchLength)*Math.cos(a[e].angle),a[e].y=(s+a[e].branchLength)*Math.sin(a[e].angle)}return a[0].r=0,a[0].x=0,a[0].y=0,a}function readTree(e){var n=(e=e.replace(/ \t/g,"")).split(/(;|\(|\)|,)/),l={parent:null,children:[]},r=l,t=0;for(const e of n)if(""!=e&&";"!=e)if("("==e){var a={parent:r,children:[]};r.children.push(a),r=a}else if(","==e){a={parent:r=r.parent,children:[]};r.children.push(a),r=a}else if(")"==e){if(null===(r=r.parent))break}else{var h=e.split(":");1==h.length?e.startsWith(":")?(r.label="",r.branchLength=parseFloat(h[0])):(r.label=h[0],r.branchLength=null):2==h.length?(r.label=h[0],r.branchLength=parseFloat(h[1])):console.warn(e,"I don't know what to do with two colons!"),r.id=t++}return r.id=t,l}function rectangleLayout(t){var r={};return r.horizontal_lines=get_horizontal(t),r.vertical_lines=get_vertical(t),r}function get_vertical(t){var r=get_horizontal(t);function n(t){for(var n=0;n<r.length;n++)if(r[n].parentId===t.parentId)var e=Math.abs(r[n].y0-t.y0);return e}for(var e=[],i=r.map(t=>null===t.parentId?t.thisId:null).filter(t=>null!=t)[0],l=0;l<r.length;l++)r[l].thisId!==i&&e.push({thisId:r[l].thisId,x0:r[l].x0,x1:r[l].x0,y0:r[l].y0,y1:r[l].y0+n(r[l]),heights:n(r[l])});return e}function get_horizontal(t){var r=fortify(t);r.map(t=>t.isTip?t.thisLabel:null).filter(t=>null!=t);r.map(t=>t.y=null);for(var n=1,e=0;e<r.length;e++)1==r[e].isTip&&(r[e].y0=n,r[e].y1=n,n+=1);function i(t,n){for(var e=0;e<r.length;e++){if(r[e].thisId===t)var i=r[e].y0;if(r[e].thisId===n)var l=r[e].y0}return(a=[i,l]).reduce((t,r)=>t+r)/a.length;var a}for(e=0;e<r.length;e++)!1===r[e].isTip&&(r[e].y0=i(r[e].children[0],r[e].children[1]),r[e].y1=i(r[e].children[0],r[e].children[1]));var l=r.map(t=>null===t.parentId?t.thisId:null).filter(t=>null!=t)[0];function a(t){for(var n=0;n<r.length;n++)if(r[n].thisId===t)var e=r[n].x1;return e}r.sort((t,r)=>r.thisId-t.thisId);for(e=0;e<r.length;e++)if(r[e].parentId===l)r[e].x0=0,r[e].x1=r[e].branchLength;else{var h=a(r[e].parentId);r[e].x0=h,r[e].x1=h+r[e].branchLength}return r.sort((t,r)=>t.thisId-r.thisId),r.map(({y:t,x:r,angle:n,...e})=>e)}function unrooted(t){var n={},e=fortify(equalAngleLayout(t));return n.tree_df=e,n.edges=edges(e),n}function equalAngleLayout(t){null===t.parent&&(t.start=0,t.end=2,t.angle=0,t.ntips=numTips(t),t.x=0,t.y=0);for(var n,e,a=t.start,r=0;r<t.children.length;r++)(n=t.children[r]).ntips=numTips(n),e=(t.end-t.start)*n.ntips/t.ntips,n.start=a,n.end=n.start+e,n.angle=n.start+(n.end-n.start)/2,a=n.end,n.x=t.x+n.branchLength*Math.sin(n.angle*Math.PI),n.y=t.y+n.branchLength*Math.cos(n.angle*Math.PI),equalAngleLayout(n);return t}function preorder(n,r=[]){r.push(n);for(var e=0;e<n.children.length;e++)r=preorder(n.children[e],r);return r}function levelorder(n){for(var r,e=[n],t=[];e.length>0;){r=e.pop(),t.push(r);for(const n of r.children)e.push(n)}return t}function numTips(n){var r=0;for(const e of levelorder(n))0==e.children.length&&r++;return r}function fortify(n,r=!0){var e=[];for(const r of preorder(n))null===r.parent?e.push({parentId:null,parentLabel:null,thisId:r.id,thisLabel:r.label,children:r.children.map(n=>n.id),branchLength:0,isTip:!1,x:r.x,y:r.y,angle:r.angle}):e.push({parentId:r.parent.id,parentLabel:r.parent.label,thisId:r.id,thisLabel:r.label,children:r.children.map(n=>n.id),branchLength:r.branchLength,isTip:0==r.children.length,x:r.x,y:r.y,angle:r.angle});return r&&(e=e.sort((function(n,r){return n.thisId-r.thisId}))),e}function edges(n,r=!1){var e,t=[];n.sort((function(n,r){return n.thisId-r.thisId}));for(const d of n){d.x,d.y;if(null!==d.parentId&&null!=(e=n[d.parentId]))if(r){var i={x1:d.x,y1:d.y,id1:d.thisId,x2:e.x,y2:d.y,id2:void 0};t.push(i);i={x1:e.x,y1:d.y,id1:void 0,x2:e.x,y2:e.y,id2:d.parentId};t.push(i)}else{i={x1:d.x,y1:d.y,id1:d.thisId,x2:e.x,y2:e.y,id2:d.parentId};t.push(i)}}return t} export { describeArc,polarToCartesian,radialLayout,get_arcs,reflectAngle,get_radii,radial_data,readTree,rectangleLayout,get_vertical,get_horizontal,unrooted,equalAngleLayout,preorder,levelorder,numTips,fortify,edges };
